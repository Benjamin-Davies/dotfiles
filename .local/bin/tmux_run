#!/usr/bin/env python3

from subprocess import call
from sys import argv
from os import environ

command = None
terminal = None

current_flag = None
for arg in argv[1:]:
  if current_flag != None:
    if current_flag == '-t':
      terminal = arg
    current_flag = None

  elif arg.startswith('-'):
    if arg == '-t':
      current_flag = arg
    else:
      print(f'Invalid option: {arg}')

  else:
    if command == None:
      command = arg
    else:
      command += ' ' + arg

if command == None:
  command = 'echo No command specified; read'

call(['tmux', 'new-window', command])

if terminal != None and call(['pgrep', f'^{terminal}']) != 0:
  # So that tmux definitely opens in the terminal
  term_env = environ.copy()
  term_env['TMUX'] = ''

  call([terminal], env=term_env)
